import{b as ve,V as de}from"./VInput-e9a4f1c5.js";import{m as fe}from"./VSelect-9e13c019.js";import{f as me}from"./forwardRefs-a29b5f65.js";import{m as be,u as pe}from"./filter-c4065068.js";import{m as he}from"./transition-b17afeea.js";import{u as xe,t as R,V as ge,a as j}from"./VList-6a1575ca.js";import{as as ye,aA as ke,aF as Ce,k as V,aD as q,z as p,aw as Ve,aK as _e,X as T,ba as H,az as we,p as s,F as W,Y as D,bl as Ae,L as Ie,d as De,ar as X,o as Y,c as Pe,q as E,b as Fe,v as Se,a9 as Re,a as Te,B as Ee,n as Le,aa as G,ab as J,s as $e}from"./index-5d9aac78.js";import{m as Me,V as Q}from"./VTextField-ecd483ce.js";import{V as Ne}from"./VMenu-b6e1d5f8.js";import{V as Be}from"./VCheckboxBtn-9f05cacf.js";import{V as ze}from"./VChip-b9ee51ce.js";function Oe(e,d,y){if(d==null)return e;if(Array.isArray(d))throw new Error("Multiple matches is not implemented");return typeof d=="number"&&~d?s(W,null,[s("span",{class:"v-combobox__unmask"},[e.substr(0,d)]),s("span",{class:"v-combobox__mask"},[e.substr(d,y)]),s("span",{class:"v-combobox__unmask"},[e.substr(d+y)])]):e}const Ue=ye()({name:"VCombobox",props:{delimiters:Array,...be({filterKeys:["title"]}),...fe({hideNoData:!0,returnObject:!0}),...ke(Me({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...he({transition:!1})},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,d){var K;let{emit:y,slots:a}=d;const{t:A}=Ce(),g=V(),m=V(!1),h=V(!0),O=V(),L=q(e,"menu"),v=p({get:()=>L.value,set:l=>{var t;L.value&&!l&&((t=O.value)!=null&&t.Î¨openChildren)||(L.value=l)}}),u=V(-1);let $=!1;const Z=p(()=>{var l;return(l=g.value)==null?void 0:l.color}),{items:M,transformIn:ee,transformOut:le}=xe(e),{textColorClasses:ae,textColorStyles:te}=Ve(Z),c=q(e,"modelValue",[],l=>ee(_e(l)),l=>{const t=le(l);return e.multiple?t:t[0]??null}),_=ve(),w=V(e.multiple?"":((K=c.value[0])==null?void 0:K.title)??""),i=p({get:()=>w.value,set:l=>{var t;if(w.value=l,e.multiple||(c.value=[R(e,l)]),l&&e.multiple&&((t=e.delimiters)!=null&&t.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(x=>{x=x.trim(),x&&C(R(e,x))}),w.value="")}l||(u.value=-1),h.value=!l}});T(w,l=>{$?H(()=>$=!1):m.value&&!v.value&&(v.value=!0),y("update:search",l)}),T(c,l=>{var t;e.multiple||(w.value=((t=l[0])==null?void 0:t.title)??"")});const{filteredItems:P,getMatches:ne}=pe(e,M,p(()=>h.value?void 0:i.value)),k=p(()=>c.value.map(l=>M.value.find(t=>e.valueComparator(t.value,l.value))||l)),N=p(()=>e.hideSelected?P.value.filter(l=>!k.value.some(t=>t.value===l.value)):P.value),B=p(()=>k.value.map(l=>l.props.value)),U=p(()=>k.value[u.value]),z=V();function ue(l){$=!0,e.openOnClear&&(v.value=!0)}function oe(){e.hideNoData&&!M.value.length||e.readonly||_!=null&&_.isReadonly.value||(v.value=!0)}function se(l){var x,n;if(e.readonly||_!=null&&_.isReadonly.value)return;const t=g.value.selectionStart,r=B.value.length;if((u.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(v.value=!0),["Escape"].includes(l.key)&&(v.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(h.value=!0),l.key==="ArrowDown"?(x=z.value)==null||x.focus("next"):l.key==="ArrowUp"&&((n=z.value)==null||n.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(u.value<0){l.key==="Backspace"&&!i.value&&(u.value=r-1);return}const o=u.value;U.value&&C(U.value),u.value=o>=r-1?r-2:o}if(l.key==="ArrowLeft"){if(u.value<0&&t>0)return;const o=u.value>-1?u.value-1:r-1;k.value[o]?u.value=o:(u.value=-1,g.value.setSelectionRange(i.value.length,i.value.length))}if(l.key==="ArrowRight"){if(u.value<0)return;const o=u.value+1;k.value[o]?u.value=o:(u.value=-1,g.value.setSelectionRange(0,0))}l.key==="Enter"&&i.value&&(C(R(e,i.value)),i.value="")}}function ie(){m.value&&(h.value=!0)}function C(l){if(e.multiple){const t=B.value.findIndex(r=>e.valueComparator(r,l.value));if(t===-1)c.value=[...c.value,l];else{const r=[...c.value];r.splice(t,1),c.value=r}i.value=""}else c.value=[l],w.value=l.title,H(()=>{v.value=!1,h.value=!0})}function re(l){m.value=!0}function ce(l){var t;l.relatedTarget==null&&((t=g.value)==null||t.focus())}return T(P,l=>{!l.length&&e.hideNoData&&(v.value=!1)}),T(m,l=>{if(l)u.value=-1;else{if(v.value=!1,!e.multiple||!i.value)return;c.value=[...c.value,R(e,i.value)],i.value=""}}),we(()=>{const l=!!(e.chips||a.chip),t=!!(!e.hideNoData||N.value.length||a.prepend||a.append||a["no-data"]),r=c.value.length>0,[x]=Q.filterProps(e);return s(Q,D({ref:g},x,{modelValue:i.value,"onUpdate:modelValue":[n=>i.value=n,n=>{n==null&&(c.value=[])}],focused:m.value,"onUpdate:focused":n=>m.value=n,validationValue:c.externalValue,dirty:r,class:["v-combobox",{"v-combobox--active-menu":v.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":u.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,placeholder:r?void 0:e.placeholder,"onClick:clear":ue,"onMousedown:control":oe,onKeydown:se}),{...a,default:()=>s(W,null,[s(Ne,D({ref:O,modelValue:v.value,"onUpdate:modelValue":n=>v.value=n,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ie},e.menuProps),{default:()=>[t&&s(ge,{ref:z,selected:B.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onFocusin:re,onFocusout:ce},{default:()=>{var n,o,F;return[!N.value.length&&!e.hideNoData&&(((n=a["no-data"])==null?void 0:n.call(a))??s(j,{title:A(e.noDataText)},null)),(o=a["prepend-item"])==null?void 0:o.call(a),N.value.map(f=>{var I;return((I=a.item)==null?void 0:I.call(a,{item:f,props:D(f.props,{onClick:()=>C(f)})}))??s(j,D({key:f.value},f.props,{onClick:()=>C(f)}),{prepend:b=>{let{isSelected:S}=b;return e.multiple&&!e.hideSelected?s(Be,{modelValue:S,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var b,S;return h.value?f.title:Oe(f.title,(b=ne(f))==null?void 0:b.title,((S=i.value)==null?void 0:S.length)??0)}})}),(F=a["append-item"])==null?void 0:F.call(a)]}})]}),k.value.map((n,o)=>{var I;function F(b){b.stopPropagation(),b.preventDefault(),C(n)}const f={"onClick:close":F,modelValue:!0,"onUpdate:modelValue":void 0};return s("div",{key:n.value,class:["v-combobox__selection",o===u.value&&["v-combobox__selection--selected",ae.value]],style:o===u.value?te.value:{}},[l?a.chip?s(Ae,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>{var b;return[(b=a.chip)==null?void 0:b.call(a,{item:n,index:o,props:f})]}}):s(ze,D({key:"chip",closable:e.closableChips,size:"small",text:n.title},f),null):((I=a.selection)==null?void 0:I.call(a,{item:n,index:o}))??s("span",{class:"v-combobox__selection-text"},[n.title,e.multiple&&o<k.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[Ie(",")])])])})])})}),me({isFocused:m,isPristine:h,menu:v,search:i,selectionIndex:u,filteredItems:P,select:C},g)}}),Ke=De({name:"AppCombobox",inheritAttrs:!1}),ll=Object.assign(Ke,{setup(e){const d=p(()=>{const a=X(),A=a.id||a.label;return A?`app-combobox-${A}-${Math.random().toString(36).slice(2,7)}`:void 0}),y=p(()=>X().label);return(a,A)=>(Y(),Pe("div",{class:$e(["app-combobox flex-grow-1",a.$attrs.class])},[E(y)?(Y(),Fe(de,{key:0,for:E(d),class:"mb-1 text-body-2 text-high-emphasis",text:E(y)},null,8,["for","text"])):Se("",!0),s(Ue,G(J({...a.$attrs,class:null,label:void 0,variant:"outlined",id:E(d),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",a.$attrs.multiple!==void 0?"v-list-select-multiple":""]}})),Re({_:2},[Te(a.$slots,(g,m)=>({name:m,fn:Ee(h=>[Le(a.$slots,m,G(J(h||{})))])}))]),1040)],2))}});export{Ue as V,ll as _};
